  <script src="/lib/loader/boot.js" defer></script>
  <script type="module" src="/scripts/config/apply-config.js"></script>
<!-- 
    Banner de Cookies HTML Puro - Para incluir directamente en las p√°ginas
    Copia este c√≥digo antes del cierre de </body> en cada p√°gina
-->

<!-- Banner en Espa√±ol -->
<div id="cookie-banner-es" class="hidden fixed inset-x-0 bottom-0 z-50 bg-gray-900 text-white p-4 shadow-2xl">
    <div class="container mx-auto">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
            <!-- Contenido del mensaje -->
            <div class="flex-1">
                <h2 class="text-lg font-semibold mb-2">üç™ Usamos cookies</h2>
                <p class="text-sm text-gray-300">
                    Utilizamos cookies para mejorar la funcionalidad
                    <a href="/politica-de-cookies.html" target="_blank" rel="noopener" class="text-blue-400 underline hover:text-blue-300">
                        pol√≠tica de privacidad
                    </a>.
                </p>
            </div>
            
            <!-- Botones de acci√≥n -->
            <div class="flex gap-3 w-full md:w-auto">
                <!-- Bot√≥n Aceptar (izquierda) -->
                <button onclick="handleCookieConsent('accept')" 
                        class="flex-1 md:flex-initial bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                    ‚úÖ Aceptar todo
                </button>
                
                <!-- Bot√≥n Rechazar (derecha) -->
                <button onclick="handleCookieConsent('reject')" 
                        class="flex-1 md:flex-initial bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                    ‚ùå Rechazar todo
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Banner en Ingl√©s -->
<div id="cookie-banner-en" class="hidden fixed inset-x-0 bottom-0 z-50 bg-gray-900 text-white p-4 shadow-2xl">
    <div class="container mx-auto">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
            <!-- Contenido del mensaje -->
            <div class="flex-1">
                <h2 class="text-lg font-semibold mb-2">üç™ We use cookies</h2>
                <p class="text-sm text-gray-300">
                    We use cookies to improve functionality and measure performance
                    <a href="/politica-de-cookies.html" target="_blank" rel="noopener" class="text-blue-400 underline hover:text-blue-300">
                        View privacy policy
                    </a>.
                </p>
            </div>
            
            <!-- Botones de acci√≥n -->
            <div class="flex gap-3 w-full md:w-auto">
                <!-- Accept Button (left) -->
                <button onclick="handleCookieConsent('accept')" 
                        class="flex-1 md:flex-initial bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                    ‚úÖ Accept all
                </button>
                
                <!-- Reject Button (right) -->
                <button onclick="handleCookieConsent('reject')" 
                        class="flex-1 md:flex-initial bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                    ‚ùå Reject all
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Script integrado para funcionar sin dependencias externas -->
<script>
// Funciones para manejar cookies sin dependencias
function setCookieBasic(name, value, days) {
    const maxAge = days * 24 * 60 * 60;
    const encoded = encodeURIComponent(value);
    const secure = location.protocol === 'https:' ? '; Secure' : '';
    document.cookie = `${name}=${encoded}; Path=/; Max-Age=${maxAge}; SameSite=Lax${secure}`;
}

function getCookieBasic(name) {
    return document.cookie
        .split('; ')
        .map(v => v.split('='))
        .reduce((acc, [k, v]) => (k === name ? decodeURIComponent(v) : acc), null);
}

function hasExistingConsent() {
    return getCookieBasic('site_consent') || localStorage.getItem('site_consent');
}

function detectLanguage() {
    return navigator.language?.startsWith('en') || document.documentElement.lang === 'en' ? 'en' : 'es';
}

function showCookieBanner() {
    if (hasExistingConsent()) return;
    
    const lang = detectLanguage();
    const bannerId = `cookie-banner-${lang}`;
    const banner = document.getElementById(bannerId);
    
    if (banner) {
        banner.classList.remove('hidden');
    }
}

function handleCookieConsent(action) {
    const lang = detectLanguage();
    
    const consentData = {
        version: 1,
        lang: lang,
        categories: {
            necessary: true,
            analytics: action === 'accept',
            performance: action === 'accept',
            marketing: action === 'accept'
        },
        timestamp: Date.now()
    };
    
    // Guardar consentimiento
    const jsonData = JSON.stringify(consentData);
    setCookieBasic('site_consent', jsonData, 180); // 6 meses
    
    try {
        localStorage.setItem('site_consent', jsonData);
    } catch (e) {
        // Ignorar errores de localStorage
    }
    
    // Ocultar banners
    const bannerEs = document.getElementById('cookie-banner-es');
    const bannerEn = document.getElementById('cookie-banner-en');
    if (bannerEs) bannerEs.classList.add('hidden');
    if (bannerEn) bannerEn.classList.add('hidden');
    
    // Notificar al sistema de cookies si est√° disponible
    if (window.CookieConsent && window.CookieConsent._emit) {
        window.CookieConsent._emit('change', consentData);
    }
    
    // Recargar para aplicar scripts si se acept√≥
    if (action === 'accept') {
        // Opcional: recargar la p√°gina para cargar scripts anal√≠ticos
        // window.location.reload();
    }
}

// Mostrar banner cuando el DOM est√© listo
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', showCookieBanner);
} else {
    showCookieBanner();
}
</script>