  <script src="/lib/loader/boot.js" defer></script>
  <script type="module" src="/scripts/config/apply-config.js"></script>
<!-- Banner de Cookies HTML Puro - Sin JavaScript -->
<div id="cookie-banner" class="fixed inset-x-0 bottom-0 z-50 bg-gray-900 text-white p-4 shadow-2xl" style="display: none;">
    <div class="container mx-auto">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
            <!-- Contenido del mensaje -->
            <div class="flex-1">
                <h2 class="text-lg font-semibold mb-2">Usamos cookies</h2>
                <p class="text-sm text-gray-300">
                    Este sitio web utiliza cookies para mejorar la funcionalidad  
                    <a href="/politica-de-cookies.html" target="_blank" rel="noopener" class="text-blue-400 underline hover:text-blue-300">
                        política de privacidad
                    </a>.
                </p>
            </div>
            
            <!-- Botones de acción -->
            <div class="flex gap-3 w-full md:w-auto">
                <!-- Botón Aceptar (izquierda) -->
                <form method="post" action="/cookie-consent" class="flex-1 md:flex-initial">
                    <input type="hidden" name="consent" value="accept">
                    <input type="hidden" name="categories" value='{"necessary":true,"analytics":true,"performance":true,"marketing":true}'>
                    <button type="submit" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                        Aceptar todo
                    </button>
                </form>
                
                <!-- Botón Rechazar (derecha) -->
                <form method="post" action="/cookie-consent" class="flex-1 md:flex-initial">
                    <input type="hidden" name="consent" value="reject">
                    <input type="hidden" name="categories" value='{"necessary":true,"analytics":false,"performance":false,"marketing":false}'>
                    <button type="submit" 
                            class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                        Rechazar todo
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Versión en inglés (se muestra si lang="en") -->
<div id="cookie-banner-en" class="fixed inset-x-0 bottom-0 z-50 bg-gray-900 text-white p-4 shadow-2xl" style="display: none;">
    <div class="container mx-auto">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
            <!-- Contenido del mensaje -->
            <div class="flex-1">
                <h2 class="text-lg font-semibold mb-2">We use cookies</h2>
                <p class="text-sm text-gray-300">
                    We use cookies to improve functionality 
                    <a href="/politica-de-cookies.html" target="_blank" rel="noopener" class="text-blue-400 underline hover:text-blue-300">
                        our privacy policy
                    </a>.
                </p>
            </div>
            
            <!-- Botones de acción -->
            <div class="flex gap-3 w-full md:w-auto">
                <!-- Botón Accept (izquierda) -->
                <form method="post" action="/cookie-consent" class="flex-1 md:flex-initial">
                    <input type="hidden" name="consent" value="accept">
                    <input type="hidden" name="categories" value='{"necessary":true,"analytics":true,"performance":true,"marketing":true}'>
                    <button type="submit" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                        Accept all
                    </button>
                </form>
                
                <!-- Botón Reject (derecha) -->
                <form method="post" action="/cookie-consent" class="flex-1 md:flex-initial">
                    <input type="hidden" name="consent" value="reject">
                    <input type="hidden" name="categories" value='{"necessary":true,"analytics":false,"performance":false,"marketing":false}'>
                    <button type="submit" 
                            class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                        Reject all
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Script mínimo para mostrar/ocultar el banner sin depender de JS externo -->
<script>
(function() {
    // Verificar si ya hay consentimiento guardado
    const hasConsent = document.cookie.includes('site_consent=') || localStorage.getItem('site_consent');
    
    if (!hasConsent) {
        // Detectar idioma
        const isEnglish = navigator.language?.startsWith('en') || document.documentElement.lang === 'en';
        const bannerId = isEnglish ? 'cookie-banner-en' : 'cookie-banner';
        
        // Mostrar banner apropiado
        const banner = document.getElementById(bannerId);
        if (banner) {
            banner.style.display = 'block';
        }
        
        // Manejar envío de formularios si JS está disponible
        const forms = banner?.querySelectorAll('form');
        forms?.forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(form);
                const consent = formData.get('consent');
                const categories = formData.get('categories');
                
                // Guardar consentimiento
                const consentData = {
                    version: 1,
                    lang: isEnglish ? 'en' : 'es',
                    categories: JSON.parse(categories),
                    timestamp: Date.now()
                };
                
                // Guardar en cookie y localStorage
                const maxAge = 180 * 24 * 60 * 60; // 6 meses
                const cookieValue = encodeURIComponent(JSON.stringify(consentData));
                document.cookie = `site_consent=${cookieValue}; Path=/; Max-Age=${maxAge}; SameSite=Lax${location.protocol === 'https:' ? '; Secure' : ''}`;
                
                try {
                    localStorage.setItem('site_consent', JSON.stringify(consentData));
                } catch {}
                
                // Ocultar banner
                banner.style.display = 'none';
                
                // Cargar scripts si se aceptaron
                if (consent === 'accept' && window.CookieConsent) {
                    // Si el sistema JS está disponible, notificar
                    window.CookieConsent._emit('change', consentData);
                }
            });
        });
    }
})();
</script>